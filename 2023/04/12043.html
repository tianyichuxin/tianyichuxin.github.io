<!DOCTYPE HTML>
<html lang="zh-CN">
<!-- 自动将http的不安全请求升级为https -->
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="vue,vue3">
    <meta name="description" content="专注于前端领域开发技术分享，深信任何可以用 JavaScript 来写的应用，最终都将用 JavaScript 来写">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Vue3新特性及和Vue2的部分差异性（持续更新汇中） | 天弈初心</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <link rel="stylesheet" type="text/css" href="/css/advertisement-space.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="天弈初心" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">天弈初心</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


    <div id="mobile-nav" class="side-nav sidenav">

        <div class="mobile-head bg-color">
            
                <img src="/medias/logo.png" class="logo-img circle responsive-img">
                
                    <div class="logo-name">
                        天弈初心
                    </div>
                    <div class="logo-desc">
                        
                            专注于前端领域开发技术分享，深信任何可以用 JavaScript 来写的应用，最终都将用 JavaScript 来写
                                
                    </div>
        </div>

        

            <ul class="menu-list mobile-menu-list">
                
                    <li class="m-nav-item">
                        
                            <a href="/" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-home"></i>
                                    
                                            首页
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/tags" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-tags"></i>
                                    
                                            标签
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/categories" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-bookmark"></i>
                                    
                                            分类
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/archives" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-archive"></i>
                                    
                                            归档
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/about" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-user-circle"></i>
                                    
                                            关于
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/contact" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-comments"></i>
                                    
                                            留言板
                            </a>
                            
                    </li>
                    
                    <li class="m-nav-item">
                        
                            <a href="/friends" class="waves-effect waves-light">
                                
                                    <i class="fa-fw fas fa-address-book"></i>
                                    
                                            友链
                            </a>
                            
                    </li>
                    
                        
                            <li>
                                <div class="divider"></div>
                            </li>
                            <li>
                                <a href="https://github.com/tianyichuxin/tianyichuxin.github.io" class="waves-effect waves-light" target="_blank">
                                    <i class="fab fa-github-square fa-fw"></i>
                                    Fork Me
                                </a>
                            </li>
                            
            </ul>
    </div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/tianyichuxin/tianyichuxin.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/19.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Vue3新特性及和Vue2的部分差异性（持续更新汇中）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <!-- 内页 -->
<link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/vue/">
                                <span class="chip bg-color">vue</span>
                            </a>
                        
                            <a href="/tags/vue3/">
                                <span class="chip bg-color">vue3</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/vue/" class="post-category">
                                vue
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-04-08
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-08-14
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    56 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="一、Vue3的改动（和Vue2的差异性，非兼容性改变）"><a href="#一、Vue3的改动（和Vue2的差异性，非兼容性改变）" class="headerlink" title="一、Vue3的改动（和Vue2的差异性，非兼容性改变）"></a>一、Vue3的改动（和Vue2的差异性，非兼容性改变）</h2><h3 id="1-生命周期钩子函数命名发生变化"><a href="#1-生命周期钩子函数命名发生变化" class="headerlink" title="1.生命周期钩子函数命名发生变化"></a>1.生命周期钩子函数命名发生变化</h3><p>Vue2 生命周期</p>
<table>
<thead>
<tr>
<th>Vue2 钩子函数</th>
<th>Vue3  钩子函数（选项式API）</th>
<th>Vue3  钩子函数（组合式API）</th>
</tr>
</thead>
<tbody><tr>
<td>beforeCreate</td>
<td>beforeCreate</td>
<td>-</td>
</tr>
<tr>
<td>created</td>
<td>created</td>
<td>-</td>
</tr>
<tr>
<td>beforeMount</td>
<td>beforeMount</td>
<td>onBeforeMount</td>
</tr>
<tr>
<td>mounted</td>
<td>mounted</td>
<td>onMounted</td>
</tr>
<tr>
<td>beforeUpdate</td>
<td>beforeUpdate</td>
<td>onBeforeUpdate</td>
</tr>
<tr>
<td>updated</td>
<td>updated</td>
<td>onUpdated</td>
</tr>
<tr>
<td>activated</td>
<td>activated</td>
<td>onActivated</td>
</tr>
<tr>
<td>deactivated</td>
<td>deactivated</td>
<td>onDeactivated</td>
</tr>
<tr>
<td>beforeDestory</td>
<td>beforeUnmount</td>
<td>onBeforeUnmount</td>
</tr>
<tr>
<td>destoryed</td>
<td>unmounted</td>
<td>onUnmounted</td>
</tr>
<tr>
<td>errorCaptured(可以忽略)</td>
<td>errorCaptured(可以忽略)</td>
<td>onErrorCaptured(可以忽略)</td>
</tr>
<tr>
<td>-</td>
<td>renderTracked (dev only，可以忽略)</td>
<td>onRenderTracked(dev only，可以忽略)</td>
</tr>
<tr>
<td>-</td>
<td>renderTriggered (dev only，可以忽略)</td>
<td>onRenderTriggered(dev only，可以忽略)</td>
</tr>
<tr>
<td>-</td>
<td>serverPrefetch(SSR only，可以忽略)</td>
<td>onServerPrefetch(SSR only，可以忽略)</td>
</tr>
</tbody></table>
<p><img src="//static.tianyichuxin.com/images/12043/vue2.png" alt="vue2 生命周期"></p>
<p><img src="//static.tianyichuxin.com/images/12043/vue3.png" alt="vue3 生命周期"></p>
<h3 id="2-全局-API"><a href="#2-全局-API" class="headerlink" title="2.全局 API"></a>2.全局 API</h3><h4 id="2-1-Vue声明变化"><a href="#2-1-Vue声明变化" class="headerlink" title="2.1 Vue声明变化"></a>2.1 Vue声明变化</h4><p>新增一个新的全局 API：<code>createApp</code>，调用 <code>createApp</code> 返回一个应用实例。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    {{message}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
    <span class="token comment" spellcheck="true">//Vue2</span>
    <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
        data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            message<span class="token punctuation">:</span> <span class="token string">'Vue'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//Vue3</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span>
    Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//Vue3 或</span>
    <span class="token keyword">const</span> app<span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">//Vue3 或</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue

    <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>从技术上讲，Vue 2 没有<code>app</code>的概念，我们定义的应用只是通过 <code>new Vue()</code> 创建的根 Vue 实例。从同一个 Vue 构造函数创建的<strong>每个根实例</strong>共享相同的全局配置。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 这会影响到所有根实例</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> el<span class="token punctuation">:</span> <span class="token string">'#app-1'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> el<span class="token punctuation">:</span> <span class="token string">'#app-2'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="2-2-全局globalProperties"><a href="#2-2-全局globalProperties" class="headerlink" title="2.2 全局globalProperties"></a>2.2 全局globalProperties</h4><blockquote>
<p><code>app.config.globalProperties</code> 替换 <code>Vue.prototype</code></p>
</blockquote>
<p>在 Vue 2 中， <code>Vue.prototype</code> 通常用于添加所有组件都能访问的 <code>property</code>。</p>
<p>在 Vue 3 中与之对应的是 <code>app.config.globalProperties</code>。这些 <code>property</code> 将被复制到应用中，作为实例化组件的一部分。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 之前 - Vue 2</span>
Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$http <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 之后 - Vue 3</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$http <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>添加一个可以在应用的任何组件实例中访问的全局 <code>property</code>。组件的 <code>property</code> 在命名冲突具有优先权。</p>
<p>用法：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//定义</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span>

<span class="token comment" spellcheck="true">//使用</span>
app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    template<span class="token punctuation">:</span> <span class="token string">'#child-component'</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'bar'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//app指 const app = Vue.createApp({})</span>

<span class="token comment" spellcheck="true">//或</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> proxy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 'bar'</span></code></pre>
<h4 id="2-3-Vue-extend-移除"><a href="#2-3-Vue-extend-移除" class="headerlink" title="2.3 Vue.extend 移除"></a>2.3 Vue.extend 移除</h4><blockquote>
<p><code>Vue.extend</code> 移除，现用<code>createApp</code>代替</p>
</blockquote>
<p>在 Vue 2.x 中，<code>Vue.extend</code> 曾经被用于创建一个基于 Vue 构造函数的“子类”，其参数应为一个包含组件选项的对象。</p>
<p>在 Vue 3.x 中，我们已经没有<strong>组件构造器</strong>的概念了。应该始终使用 <code>createApp</code> 这个全局 API 来挂载组件：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 之前 - Vue 2</span>
<span class="token comment" spellcheck="true">// 创建构造器</span>
<span class="token keyword">const</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    template<span class="token punctuation">:</span> <span class="token string">'&lt;p>{{firstName}} {{lastName}} aka {{alias}}&lt;/p >'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            firstName<span class="token punctuation">:</span> <span class="token string">'Walter'</span><span class="token punctuation">,</span>
            lastName<span class="token punctuation">:</span> <span class="token string">'White'</span><span class="token punctuation">,</span>
            alias<span class="token punctuation">:</span> <span class="token string">'Heisenberg'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 创建一个 Profile 的实例，并将它挂载到一个元素上</span>
<span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#mount-point'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 之后 - Vue 3</span>
<span class="token keyword">const</span> Profile <span class="token operator">=</span> <span class="token punctuation">{</span>
    template<span class="token punctuation">:</span> <span class="token string">'&lt;p>{{firstName}} {{lastName}} aka {{alias}}&lt;/p >'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            firstName<span class="token punctuation">:</span> <span class="token string">'Walter'</span><span class="token punctuation">,</span>
            lastName<span class="token punctuation">:</span> <span class="token string">'White'</span><span class="token punctuation">,</span>
            alias<span class="token punctuation">:</span> <span class="token string">'Heisenberg'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>Profile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#mount-point'</span><span class="token punctuation">)</span></code></pre>
<p><strong>类型推断</strong><br>在 Vue 2 中，<code>Vue.extend</code> 也被用来为组件选项提供 TypeScript 类型推断。在 Vue 3 中，为了达到相同的目的，<code>defineComponent</code> 全局 API 可以用来作为 <code>Vue.extend</code> 的替代方案。</p>
<p>需要注意的是，虽然 <code>defineComponent</code> 的返回类型是一个类似构造器的类型，但是它的目的仅仅是为了 TSX 的推断。在运行时 <code>defineComponent</code> 里基本没有什么操作，只会原样返回该选项对象。</p>
<p><strong>组件继承</strong><br>在 Vue 3 中，我们强烈建议使用 <strong>组合式 API</strong> 来替代继承与 mixin。如果因为某种原因仍然需要使用组件继承，你可以使用 <a href="https://cn.vuejs.org/api/options-composition.html#extends" target="_blank" rel="noopener">extends 选项</a> 来代替 <code>Vue.extend</code>。</p>
<h4 id="2-4-全局-API-Treeshaking"><a href="#2-4-全局-API-Treeshaking" class="headerlink" title="2.4 全局 API Treeshaking"></a>2.4 全局 API Treeshaking</h4><p>Vue 2.x 中的这些全局 API 受此更改的影响：</p>
<ul>
<li>Vue.nextTick (通过导入 <code>import { nextTick } from 'vue'</code> 直接调用)</li>
<li>Vue.observable (用 Vue.reactive 替换)</li>
<li>Vue.version</li>
<li>Vue.compile (仅完整构建版本)</li>
<li>Vue.set (仅兼容构建版本)</li>
<li>Vue.delete (仅兼容构建版本)</li>
</ul>
<p><em>任何全局改变 Vue 行为的 API 现在都会移动到应用实例上</em>，以下是 Vue2 全局 API 及其相应的实例 API 列表： </p>
<table>
<thead>
<tr>
<th>2.x 全局 API</th>
<th>3.x 实例 API (<code>app</code>)</th>
</tr>
</thead>
<tbody><tr>
<td>Vue.config</td>
<td>app.config</td>
</tr>
<tr>
<td>Vue.config.productionTip</td>
<td><em>移除</em></td>
</tr>
<tr>
<td>Vue.config.ignoredElements</td>
<td>app.config.compilerOptions.isCustomElement</td>
</tr>
<tr>
<td>Vue.component</td>
<td>app.component</td>
</tr>
<tr>
<td>Vue.directive</td>
<td>app.directive</td>
</tr>
<tr>
<td>Vue.mixin</td>
<td>app.mixin</td>
</tr>
<tr>
<td>Vue.use</td>
<td>app.use</td>
</tr>
<tr>
<td>Vue.prototype</td>
<td>app.config.globalProperties</td>
</tr>
<tr>
<td>Vue.extend</td>
<td><em>移除</em></td>
</tr>
</tbody></table>
<p>对内联模板特性的支持已被移除（inline-template），详情参阅：<a href="https://v3-migration.vuejs.org/zh/breaking-changes/inline-template-attribute.html" target="_blank" rel="noopener">内联模板</a></p>
<h3 id="3、v-model"><a href="#3、v-model" class="headerlink" title="3、v-model"></a>3、v-model</h3><p><code>v-model</code>其实是一个语法糖，它的背后本质上是包含两个操作：</p>
<ol>
<li><code>v-bind</code>绑定一个prop <code>value</code>属性</li>
<li><code>v-on</code>指令给当前元素绑定<code>input</code>事件</li>
</ol>
<p>在 Vue2.x 中，<code>v-model</code>相当于绑定<code>value</code>属性和<code>input</code>事件，它本质也是一个<strong>语法糖</strong>：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 相当于 --></span>
&lt;input type="text" :value="message" @input = "message = $event.target.value"></code></pre>
<p>在 Vue3.x 中，它发生了如下变化：</p>
<ol>
<li>用于自定义组件时，<code>v-model</code> prop 和事件默认名称已更改：</li>
</ol>
<ul>
<li>prop：<code>value</code> -&gt; <code>modelValue</code></li>
<li>事件：<code>input</code> -&gt; <code>update:modelValue</code></li>
</ul>
<ol start="2">
<li><code>v-bind</code> 的 <code>.sync</code> 修饰符和组件的 <code>model</code> 选项已移除，可在 <code>v-model</code> 上加一个参数代替</li>
<li>新增：现在可以在同一个组件上使用多个 <code>v-model</code> 绑定；</li>
<li>新增：现在可以自定义 <code>v-model</code> 修饰符。</li>
</ol>
<h4 id="3-1-sync修饰符"><a href="#3-1-sync修饰符" class="headerlink" title="3.1 .sync修饰符"></a>3.1 .sync修饰符</h4><p>首先我们知道，在子组件中可以通过<code>$emit</code>向父组件通信，通过这种间接的方式改变<strong>父组件</strong>的<code>data</code>，从而实现子组件改变<code>props</code>的值。</p>
<p>子组件使用<code>$emit</code>向父组件发送事件：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"update:msg"</span><span class="token punctuation">,</span><span class="token string">"newValue"</span><span class="token punctuation">)</span></code></pre>
<p>父组件监听这个事件并更新一个本地的数据msg：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name">:msg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">@uptate:</span>msg</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>val<span class="token punctuation">=</span><span class="token punctuation">></span>msg<span class="token punctuation">=</span>val<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">></span></span></code></pre>
<p>为了方便这种写法，Vue提供了<code>.sync</code>修饰符，说白了就是一种简写的方式，我们可以将其当作是一种语法糖，比如<code>v-on: click</code>可以简写为<code>@click</code>。</p>
<p>而上边父组件的这种写法，换成<code>sync</code>的方式就像下边这样：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>son</span> <span class="token attr-name">:msg.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>son</span><span class="token punctuation">></span></span></code></pre>
<h4 id="3-2-Vue3-移除-sync"><a href="#3-2-Vue3-移除-sync" class="headerlink" title="3.2 Vue3 移除.sync"></a>3.2 Vue3 移除<code>.sync</code></h4><p>Vue3 中将<code>v-bind</code>和<code>.sync</code>进行了功能的整合，抛弃了<code>.sync</code>。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name">:title.sync</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 替换为 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>在 Vue3.x 中，自定义组件上的<code>v-model</code> 相当于传递了 <code>modelValue</code> prop 并接收抛出的 <code>update:modelValue</code> 事件：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 相当于 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span>
    <span class="token attr-name">:modelValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">@update:</span>modelValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle <span class="token punctuation">=</span> $event<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre>
<p>若需要更改 <code>model</code> 的名称，现在我们可以为 <code>v-model</code> 传递一个参数，以作为组件内 <code>model</code> 选项的替代：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 相当于 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">@update:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle <span class="token punctuation">=</span> $event<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>在自定义组件上使用多个 <code>v-model</code></p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span> <span class="token attr-name"><span class="token namespace">v-model:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-model:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageContent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 相当于 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ChildComponent</span>
    <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">@update:</span>title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageTitle <span class="token punctuation">=</span> $event<span class="token punctuation">"</span></span>
    <span class="token attr-name">:content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageContent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">@update:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pageContent <span class="token punctuation">=</span> $event<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre>
<blockquote>
<p>Vue <code>.sync</code>的历史：<br>Vue <code>.sync</code> 修饰符最初存在于 Vue <strong>1.0</strong> 版本里，但是在 <strong>2.0</strong> 中被移除了。但是在 <strong>2.0</strong> 发布之后的实际应用中，Vue官方发现 <code>.sync</code> 还是有其适用之处，比如在开发可<strong>复用的组件库</strong>时。开发者需要做的只是让子组件改变父组件状态的代码更容易被区分。从 <strong>2.3.0</strong> 起官方重新引入了 <code>.sync</code> 修饰符，但是<strong>这次</strong>它只是作为一个编译时的<strong>语法糖</strong>存在。它会被扩展为一个自动更新父组件属性的<code>v-on</code> 监听器。</p>
</blockquote>
<h3 id="4、v-bind合并"><a href="#4、v-bind合并" class="headerlink" title="4、v-bind合并"></a>4、v-bind合并</h3><p>在 Vue2.x 中，如果一个元素同时定义了<code>v-bind="object"</code>和一个<strong>相同的单独的属性</strong>，那么这个<strong>单独的属性会覆盖</strong><code>object</code>中的绑定：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ id: <span class="token punctuation">'</span>blue<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ id: <span class="token punctuation">'</span>blue<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 最后结果都相同 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>然而在 Vue3 中，如果一个元素同时定义了<code>v-bind="object"</code>和一个<strong>相同的单独的属性</strong>，那么声明绑定的顺序决定了最后的结果（<strong>后者覆盖前者</strong>）：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- template --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ id: <span class="token punctuation">'</span>blue<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- result --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>


<span class="token comment" spellcheck="true">&lt;!-- template --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ id: <span class="token punctuation">'</span>blue<span class="token punctuation">'</span> }<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- result --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<h3 id="5、移除-v-on-native-修饰符"><a href="#5、移除-v-on-native-修饰符" class="headerlink" title="5、移除 v-on.native 修饰符"></a>5、移除 v-on.native 修饰符</h3><h4 id="5-1-Vue2-x语法"><a href="#5-1-Vue2-x语法" class="headerlink" title="5.1 Vue2.x语法"></a>5.1 Vue2.x语法</h4><p>默认情况下，传递给带有 <code>v-on</code> 的组件的事件监听器只能通过 <code>this.$emit</code> 触发。要将原生 <code>DOM</code> 监听器添加到子组件的根元素中，可以使用 <code>.native</code> 修饰符：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span>
    <span class="token attr-name"><span class="token namespace">v-on:</span>close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleComponentEvent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">v-on:</span>click.native</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleNativeClickEvent<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span></code></pre>
<h4 id="5-2-Vue3-x语法"><a href="#5-2-Vue3-x语法" class="headerlink" title="5.2 Vue3.x语法"></a>5.2 Vue3.x语法</h4><p><code>v-on</code> 的 <code>.native</code> 修饰符已被移除。同时，新增的 <code>emits</code> 选项允许子组件定义真正会被触发的事件。</p>
<p>对于子组件中未被定义为组件触发的所有事件监听器，Vue 现在将把它们作为原生事件监听器添加到子组件的根元素中 (除非在子组件的选项中设置了 <code>inheritAttrs: false</code>)。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span>
    <span class="token attr-name"><span class="token namespace">v-on:</span>close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleComponentEvent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleNativeClickEvent<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- MyComponent.vue --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    emits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'close'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//click将被作为原生事件添加到子组件的根元素中</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h3 id="6、router和router-view"><a href="#6、router和router-view" class="headerlink" title="6、router和router-view"></a>6、router和router-view</h3><h4 id="6-1-new-Router-变成-createRouter"><a href="#6-1-new-Router-变成-createRouter" class="headerlink" title="6.1 new Router 变成 createRouter"></a>6.1 <code>new Router</code> 变成 <code>createRouter</code></h4><p><code>Vue Router</code> 不再是一个<strong>类</strong>，而是一组<strong>函数</strong>。现在你不用再写 <code>new Router()</code>，而是要调用 <code>createRouter</code>:</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 以前是</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">//现在</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<h4 id="6-2-新的-history-配置取代-mode"><a href="#6-2-新的-history-配置取代-mode" class="headerlink" title="6.2 新的 history 配置取代 mode"></a>6.2 新的 <code>history</code> 配置取代 <code>mode</code></h4><p><code>mode: 'history'</code> 配置已经被一个更灵活的 <code>history</code> 配置所取代。根据你使用的模式，你必须用适当的函数替换它：</p>
<ul>
<li><code>"history"</code>: <code>createWebHistory()</code></li>
<li><code>"hash"</code>: <code>createWebHashHistory()</code></li>
<li><code>"abstract"</code>: <code>createMemoryHistory()</code></li>
</ul>
<p>下面是一个完整的代码段：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createRouter<span class="token punctuation">,</span> createWebHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token comment" spellcheck="true">// 还有 createWebHashHistory 和 createMemoryHistory</span>

<span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    history<span class="token punctuation">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    routes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>在 <code>SSR</code> 上使用时，你需要手动传递相应的 <code>history</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// router.js</span>
<span class="token keyword">let</span> history <span class="token operator">=</span> isServer <span class="token operator">?</span> <span class="token function">createMemoryHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">createWebHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes<span class="token punctuation">,</span> history <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 在你的 server-entry.js 中的某个地方</span>
router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 请求 url</span>
router<span class="token punctuation">.</span><span class="token function">isReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 处理请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><strong>原因</strong>：为未使用的 <code>history</code> 启用摇树，以及为高级用例（如原生解决方案）实现自定义 <code>history</code>。</p>
<h4 id="6-3-路由及路由守卫"><a href="#6-3-路由及路由守卫" class="headerlink" title="6.3 路由及路由守卫"></a>6.3 路由及路由守卫</h4><h4 id="6-4-router-view"><a href="#6-4-router-view" class="headerlink" title="6.4 router-view"></a>6.4 router-view</h4><pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 之前(Vue 2.x) --></span>
<span class="token comment" spellcheck="true">&lt;!-- 此组件不需要被缓存 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>!$route.meta.keepAlive<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!-- 此组件需要被缓存 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$route.meta.keepAlive<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 之后(Vue 3.x) --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ Component }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Component<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span></code></pre>
<h3 id="7、Vuex"><a href="#7、Vuex" class="headerlink" title="7、Vuex"></a>7、Vuex</h3><p>Vue3 使用 <code>createStore</code></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//Vue2里使用vuex</span>
<span class="token comment" spellcheck="true">//main.js引入</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    store<span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> h <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// store/index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">"vuex"</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    getters<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    actions<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    modules<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// Vue3里使用vuex</span>
<span class="token comment" spellcheck="true">// main.js引入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// store/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    state<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    getters<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    actions<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    modules<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>现在 Vue3 推荐使用<code>pinia</code>替代<code>Vuex</code></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// main.js引入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App.vue"</span><span class="token punctuation">;</span> 
<span class="token keyword">import</span> <span class="token punctuation">{</span>createPinia<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span> 
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span> 
<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// store/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"pinia"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> useCounterStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">"counter"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 也可以这样定义</span>
    <span class="token comment" spellcheck="true">// state: () => ({ count: 0 })</span>
    getters<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    actions<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>更多查看，<a href="https://blog.tianyichuxin.com/2022/12/39935.html">Vue状态管理模式之Vuex和Pinia</a></p>
<h3 id="8、data、mixin"><a href="#8、data、mixin" class="headerlink" title="8、data、mixin"></a>8、data、mixin</h3><p>在 Vue2.x 中，我们可以定义<code>data</code>为<code>object</code>或者<code>function</code>，但是我们知道在组件中如果<code>data</code>是<code>object</code>的话会出现<strong>数据互相影响</strong>，因为<strong>object是引用数据类型</strong>；</p>
<p>在 Vue3 中，<code>data</code>只接受<code>function</code>类型，通过<code>function</code>返回对象；同时<code>Mixin</code>的合并行为也发生了改变，当<code>mixin</code>和<strong>基类</strong>中<code>data</code>合并时，会执行<strong>浅拷贝合并</strong>(只合并根级属性)；</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Mixin <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                name<span class="token punctuation">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span>
                id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    prov<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    city<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Component <span class="token operator">=</span> <span class="token punctuation">{</span>
    mixins<span class="token punctuation">:</span> <span class="token punctuation">[</span>Mixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    prov<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// Vue2结果：</span>
<span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'Jack'</span><span class="token punctuation">,</span>
    address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        prov<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        city<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// vue3结果：</span>
user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    address<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        prov<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>我们看到最后合并的结果，Vue2.x 会进行<strong>深拷贝</strong>，对<code>data</code>中的数据向下<strong>深入合并拷贝</strong>；而 Vue3 只进行<strong>浅层拷贝</strong>，对<code>data</code>中数据发现已存在就不合并拷贝。</p>
<blockquote>
<p>Vue3中推荐使用<code>Composition API</code>中的自定义<code>hook</code>替代<code>mixins</code>。</p>
</blockquote>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 自定义一个鼠标移动事件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> update <span class="token operator">=</span> e <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
        y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
    <span class="token punctuation">}</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>页面使用</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span>useMouse<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./hook"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//自定义一个鼠标移动事件</span></code></pre>
<p>相比<code>mixins</code>，<code>hook</code>解决了以下几点不足：</p>
<ol>
<li>混入变量来源不明确（隐式传入），不利于阅读，使代码变得难以维护。</li>
<li>多个<code>mixins</code>的生命周期会融合到一起运行，但是同名属性、同名方法无法融合，可能会导致冲突。</li>
<li><code>mixins</code>和组件可能出现多对多的关系，复杂度较高（即一个组件可以引用多个<code>mixins</code>，一个<code>mixins</code>也可以被多个组件引用）。</li>
<li><code>hook</code>本质就是一个函数。使用时调用这个函数，那么我们就很清楚复用功能代码的来源，同时减少页面代码，保持页面干净整洁。</li>
</ol>
<p>更多<code>Mixins</code>知识，查看<a href="https://blog.tianyichuxin.com/2021/05/36667.html">如何在Vue中管理Mixins</a></p>
<h3 id="9、移除-过滤器-filter"><a href="#9、移除-过滤器-filter" class="headerlink" title="9、移除  过滤器 filter"></a>9、移除  过滤器 <code>filter</code></h3><p>在 Vue2.x 中，我们还可以通过<strong>过滤器</strong><code>filter</code>来处理一些文本内容的展示：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{{ status | statusText }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            status<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        filters<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token function">statusText</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token string">'订单未下单'</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token string">'订单待支付'</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token string">'订单已完成'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>最常见的就是处理一些订单的文案展示等；</p>
<p>然而在 Vue3 中，<strong>过滤器<code>filter</code>已经删除</strong>，不再支持了，官方建议使用<code>方法调用</code>或者<code>计算属性computed</code>来进行代替。</p>
<p>如果全局注册过滤器，可通过全局属性以让它能够被所有组件使用。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// main.js</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$filters <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">currencyUSD</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'$'</span> <span class="token operator">+</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//页面</span>
<span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> $filters<span class="token punctuation">.</span><span class="token function">currencyUSD</span><span class="token punctuation">(</span>accountBalance<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p <span class="token operator">></span></code></pre>
<h3 id="10、根节点支持区别"><a href="#10、根节点支持区别" class="headerlink" title="10、根节点支持区别"></a>10、根节点支持区别</h3><p>Vue2.0中，<code>template</code>仅支持单个根节点<code>div</code><br>Vue3.0中 ，<code>template</code>取消了限制，可以支持多个根节点<code>div</code></p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- Vue2 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token comment" spellcheck="true">&lt;!-- Vue3 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h3 id="11、v-for-和-v-if"><a href="#11、v-for-和-v-if" class="headerlink" title="11、v-for 和 v-if"></a>11、v-for 和 v-if</h3><h4 id="11-1-v-for-唯一的key"><a href="#11-1-v-for-唯一的key" class="headerlink" title="11.1 v-for 唯一的key"></a>11.1 v-for 唯一的<code>key</code></h4><p>在 Vue2.x 中，我们都知道<code>v-for</code>每次循环都需要给每个子节点一个<strong>唯一</strong>的<code>key</code>，还不能绑定在<code>template</code>标签上，</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>而在 Vue3 中，<code>key</code>值<strong>应该被放置</strong>在<code>template</code>标签上，这样我们就不用为每个子节点设一遍：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item.id<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>Vue中<code>key</code>作用：<code>key</code>是每一个节点(<code>vnode</code>)的<strong>唯一标识(id)</strong>，也是<code>diff</code>的一种优化策略，可以根据<code>key</code>，更准确， 更快的找到对应的<code>vnode</code>节点。</p>
<p>必要性：当我们对数据进行更新的时候，譬如在数组中插入、移除数据时，设置的<code>key</code>值能让Vue底层<strong>高效</strong>的对新旧<code>vnode</code>进行<code>diff</code>，然后将比对出的结果用来<strong>更新真实的DOM</strong></p>
<h4 id="11-2-v-for-中的-ref属性"><a href="#11-2-v-for-中的-ref属性" class="headerlink" title="11.2 v-for 中的 ref属性"></a>11.2 v-for 中的 <code>ref</code>属性</h4><p>Vue2.x 中，在<code>v-for</code>上使用<code>ref</code>属性，通过<code>this.$refs</code>会得到<strong>一个数组</strong>：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setItemRef<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mounted <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>setItemRef<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [div, div]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>但是这样可能不是我们想要的结果；</p>
<p>因此 Vue3 <strong>不再自动创建数组</strong>，而是将<code>ref</code>的处理方式变为了<strong>函数</strong>，该函数默认传入该节点：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in 3<span class="token punctuation">"</span></span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>setItemRef<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> itemRefs <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> setItemRef <span class="token operator">=</span> el <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            itemRefs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>itemRefs<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            itemRefs<span class="token punctuation">,</span>
            setItemRef
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h4 id="11-3-v-if-v-else-v-else-if-key不再是必须的"><a href="#11-3-v-if-v-else-v-else-if-key不再是必须的" class="headerlink" title="11.3 v-if/v-else/v-else-if key不再是必须的"></a>11.3 v-if/v-else/v-else-if <code>key</code>不再是必须的</h4><p>对于 <code>v-if/v-else/v-else-if</code> 的各分支项 <code>key</code> 将不再是必须的，因为现在 Vue 会自动生成唯一的 <code>key</code>。</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- Vue 2.x --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>condition<span class="token punctuation">"</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>No<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- Vue 3.x (推荐方案：移除 key) --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>condition<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>No<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- Vue 3.x (替代方案：确保 key 始终是唯一的) --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>condition<span class="token punctuation">"</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Yes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>No<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<h4 id="11-4-v-for和v-if优先级"><a href="#11-4-v-for和v-if优先级" class="headerlink" title="11.4 v-for和v-if优先级"></a>11.4 v-for和v-if优先级</h4><p>Vue2.x：<code>v-for</code>比<code>v-if</code>有更高的优先级。</p>
<p>Vue3：<code>v-if</code>比<code>v-for</code>有更高的优先级。</p>
<p>在 Vue2.x 中，在一个元素上同时使用<code>v-for</code>和<code>v-if</code>，<code>v-for</code>有<strong>更高的优先级</strong>，因此在 Vue2.x 中做性能优化，有一个重要的点就是<code>v-for</code>和<code>v-if</code><strong>不能</strong>放在同一个元素上。</p>
<p>而在 Vue3 中，<code>v-if</code>比<code>v-for</code>有<strong>更高的优先级</strong>。因此下面的代码，在 Vue2.x 中能正常运行，但是在 Vue3 中<code>v-if</code>生效时并没有<code>item</code>变量，因此会报错：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in list<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item % 2 <span class="token punctuation">=</span><span class="token punctuation">=</span><span class="token punctuation">=</span> 0<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h3 id="12、自定义指令directive"><a href="#12、自定义指令directive" class="headerlink" title="12、自定义指令directive"></a>12、自定义指令<code>directive</code></h3><p>自定义指令<code>directive</code>钩子函数被重命名，且<code>expression</code> 字符串不再作为 <code>binding</code> 对象的一部分被传入。</p>
<p>钩子函数被重命名：<br>原来：<code>bind</code>、<code>inserted</code>、<code>update</code>、<code>componentUpdated</code>、<code>unbind</code></p>
<p>现在：<code>created</code>（新增）、<code>bind-&gt;beforeMount</code>、<code>inserted-&gt;mounted</code>、<code>beforeUpdate</code>（新增）、<code>componentUpdated-&gt;updated</code>、<code>beforeUnmount</code>（新增）、<code>unbind-&gt;unmounted</code></p>
<p>Vue2的自定义指令的钩子函数看这里，<a href="https://blog.tianyichuxin.com/2022/03/46517.html">Vue自定义指令及使用</a></p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//option API</span>
<span class="token comment" spellcheck="true">//定义</span>
<span class="token keyword">const</span> focus <span class="token operator">=</span> <span class="token punctuation">{</span>
  mounted<span class="token punctuation">:</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 使用</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  directives<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 在模板中启用 v-focus</span>
    focus
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">// template</span>
<span class="token operator">&lt;</span>input v<span class="token operator">-</span>focus <span class="token operator">/</span><span class="token operator">></span>
</code></pre>
<p>HTML部分：</p>
<pre class=" language-HTML"><code class="language-HTML"><script setup>
// composition API
const vFocus = {
  mounted: (el) => el.focus()
}
</script>
<!-- 在模板中启用 v-focus -->
<template>
  <input v-focus />
</template></code></pre>
<h4 id="12-1-自定义指令的钩子函数"><a href="#12-1-自定义指令的钩子函数" class="headerlink" title="12.1 自定义指令的钩子函数"></a>12.1 自定义指令的钩子函数</h4><p>Vue3 提供了自定义指令的7个钩子函数，它们都是可选的：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> myDirective <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 在绑定元素的 attribute 前</span>
  <span class="token comment" spellcheck="true">// 或事件监听器应用前调用</span>
  <span class="token function">created</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 下面会介绍各个参数的细节</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 在元素被插入到 DOM 前调用</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 在绑定元素的父组件</span>
  <span class="token comment" spellcheck="true">// 及他自己的所有子节点都挂载完成后调用</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 绑定元素的父组件更新前调用</span>
  <span class="token function">beforeUpdate</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 在绑定元素的父组件</span>
  <span class="token comment" spellcheck="true">// 及他自己的所有子节点都更新后调用</span>
  <span class="token function">updated</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 绑定元素的父组件卸载前调用</span>
  <span class="token function">beforeUnmount</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 绑定元素的父组件卸载后调用</span>
  <span class="token function">unmounted</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> prevVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<table>
<thead>
<tr>
<th>钩子函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>created</strong></td>
<td>只调用一次，在绑定元素的 attribute 前，或事件监听器应用前调用。</td>
</tr>
<tr>
<td><strong>beforeMount</strong></td>
<td>只调用一次，在元素被插入到 DOM 前调用。</td>
</tr>
<tr>
<td><strong>mounted</strong></td>
<td>只调用一次，在绑定元素的父组件，及他自己的所有子节点都挂载完成后调用。</td>
</tr>
<tr>
<td><strong>beforeUpdate</strong></td>
<td>绑定元素的父组件更新前调用</td>
</tr>
<tr>
<td><strong>updated</strong></td>
<td>组件更新时调用。 无论绑定值是否发生变化，只要被绑定元素所在的模板被更新即可调用。Vue.js 会通过比较更新前后的绑定值，忽略不必要的模板更新操作。</td>
</tr>
<tr>
<td><strong>beforeUnmount</strong></td>
<td>只调用一次，绑定元素的父组件卸载前调用。</td>
</tr>
<tr>
<td><strong>unmounted</strong></td>
<td>只调用一次，绑定元素的父组件卸载后调用。</td>
</tr>
</tbody></table>
<h4 id="12-2-钩子函数参数"><a href="#12-2-钩子函数参数" class="headerlink" title="12.2 钩子函数参数"></a>12.2 钩子函数参数</h4><table>
<thead>
<tr>
<th>入参</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>el</strong></td>
<td>指令所绑定的元素，可以用来直接操作 DOM。</td>
</tr>
<tr>
<td><strong>binding</strong></td>
<td>一个绑定对象（如下表），包含以下 property。</td>
</tr>
<tr>
<td><strong>vnode</strong></td>
<td>Vue 编译生成的虚拟节点。</td>
</tr>
<tr>
<td><strong>prevNode</strong></td>
<td>之前的渲染中代表指令所绑定元素的 <code>VNode</code>，仅在 <code>beforeUpdate</code> 和 <code>updated</code> 钩子中可用。</td>
</tr>
</tbody></table>
<h4 id="12-3-binding绑定对象属性"><a href="#12-3-binding绑定对象属性" class="headerlink" title="12.3 binding绑定对象属性"></a>12.3 <code>binding</code>绑定对象属性</h4><table>
<thead>
<tr>
<th>入参</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>name</strong></td>
<td>指令名，不包含前缀 v-。</td>
<td>v-focus 中的 focus</td>
</tr>
<tr>
<td><strong>value</strong></td>
<td>指令所绑定的值（计算后）。</td>
<td><code>v-my-directive="1 + 1"</code> 中，绑定值为 `2</td>
</tr>
<tr>
<td><strong>oldValue</strong></td>
<td>指令绑定的前一个值，仅在 <code>beforeUpdate</code> 和 <code>updated</code> 钩子中可用。无论值是否改变都可用。</td>
<td>-</td>
</tr>
<tr>
<td><strong>arg</strong></td>
<td>传给指令的参数，可选。</td>
<td><code>v-my-directive:foo</code> 中，参数为 <code>"foo"</code>。</td>
</tr>
<tr>
<td><strong>modifiers</strong></td>
<td>一个包含修饰符的对象。</td>
<td><code>v-my-directive.foo.bar</code> 中，修饰符对象为 <code>{ foo: true, bar: true }</code>。</td>
</tr>
<tr>
<td><strong>instance</strong></td>
<td>使用该指令的组件实例，可选。</td>
<td>-</td>
</tr>
<tr>
<td><strong>dir</strong></td>
<td>指令的定义对象，可选。</td>
<td>-</td>
</tr>
</tbody></table>
<h3 id="13、移除eventBus"><a href="#13、移除eventBus" class="headerlink" title="13、移除eventBus"></a>13、移除<code>eventBus</code></h3><p>Vue3中移除了eventBus里的<code>$on</code>、<code>$off</code> 和 <code>$once</code> 实例方法已被移除。<br>解决方案（使用第三方插件）：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// eventBus.js</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">'tiny-emitter/instance'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  $on<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  $once<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> emitter<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  $off<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> emitter<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  $emit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>在绝大多数情况下，<strong>不鼓励使用全局的事件总线在组件之间进行通信</strong></p>
</blockquote>
<p>虽然在短期内往往是最简单的解决方案，但从长期来看，它维护起来总是令人头疼。根据具体情况来看，有多种事件总线的替代方案：</p>
<ul>
<li>Props 和事件应该是父子组件之间沟通的首选。兄弟节点可以通过它们的父节点通信。</li>
<li>provide / inject 允许一个组件与它的插槽内容进行通信。这对于总是一起使用的紧密耦合的组件非常有用。</li>
<li>provide / inject 也能够用于组件之间的远距离通信。它可以帮助避免“prop 逐级透传”，即 prop 需要通过许多层级的组件传递下去，但这些组件本身可能并不需要那些 prop。</li>
<li>Prop 逐级透传也可以通过重构以使用插槽来避免。如果一个中间组件不需要某些 prop，那么表明它可能存在关注点分离的问题。在该类组件中使用 slot 可以允许父节点直接为它创建内容，因此 prop 可以被直接传递而不需要中间组件的参与。</li>
<li>全局状态管理，比如 Pinia。</li>
</ul>
<h3 id="14、Vue3-函数式组件"><a href="#14、Vue3-函数式组件" class="headerlink" title="14、Vue3 函数式组件"></a>14、Vue3 函数式组件</h3><p>现在，在 Vue3 中，所有的<strong>函数式组件</strong>都是用<strong>普通函数</strong>创建的。换句话说，不需要定义 <code>{ functional: true }</code> 组件选项。</p>
<p>它们将接收两个参数：<code>props</code> 和 <code>context</code>。<code>context</code> 参数是一个<strong>对象</strong>，包含三个属性：<code>attrs</code>、<code>emit</code> 和 <code>slots</code> property。它们分别相当于组件实例的 <code>$attrs</code>、<code>$emit</code> 和 <code>$slots</code> 这几个属性。</p>
<p>此外，<code>h</code> 现在是全局导入的，而不是在<code>render</code> 函数中隐式提供。</p>
<p>在 3.x 中，<strong>有状态组件</strong>和<strong>函数式组件</strong>之间的性能差异已经大大减少，并且在大多数用例中是微不足道的。</p>
<pre class=" language-html"><code class="language-html">// App.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hello</span><span class="token punctuation">></span></span>欢迎<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hello</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span>h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Hello <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span>props<span class="token punctuation">,</span>context<span class="token punctuation">.</span>slots<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Hello<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    components<span class="token punctuation">:</span><span class="token punctuation">{</span>
        Hello
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h3 id="15、异步组件（新增-defineAsyncComponent）"><a href="#15、异步组件（新增-defineAsyncComponent）" class="headerlink" title="15、异步组件（新增 defineAsyncComponent）"></a>15、异步组件（新增 defineAsyncComponent）</h3><ol>
<li>新的 <code>defineAsyncComponent</code> 助手方法，用于显式地定义异步组件；</li>
<li><code>component</code> 选项被重命名为 <code>loader</code>，以明确组件定义不能直接被提供；</li>
<li><code>Loader</code> 函数本身不再接收 <code>resolve</code> 和 <code>reject</code> 参数，且必须返回一个 <code>Promise</code>。</li>
</ol>
<p>以前，异步组件是通过将组件定义为返回 Promise 的函数来创建的，例如：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> asyncModal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Modal.vue'</span><span class="token punctuation">)</span></code></pre>
<p>或者，对于带有选项的更高阶的组件语法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> asyncModal <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Modal.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    timeout<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span> ErrorComponent<span class="token punctuation">,</span>
    loading<span class="token punctuation">:</span> LoadingComponent
<span class="token punctuation">}</span></code></pre>
<p>现在，由于函数式组件被定义为纯函数，因此异步组件需要通过将其包裹在新的 <code>defineAsyncComponent</code> 助手方法中来显式地定义：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> ErrorComponent <span class="token keyword">from</span> <span class="token string">'./components/ErrorComponent.vue'</span>
<span class="token keyword">import</span> LoadingComponent <span class="token keyword">from</span> <span class="token string">'./components/LoadingComponent.vue'</span>

<span class="token comment" spellcheck="true">// 不带选项的异步组件</span>
<span class="token keyword">const</span> asyncModal <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Modal.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 带选项的异步组件</span>
<span class="token keyword">const</span> asyncModalWithOptions <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Modal.vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//component 选项现在被重命名为 loader，以明确组件定义不能直接被提供</span>
    delay<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    timeout<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    errorComponent<span class="token punctuation">:</span> ErrorComponent<span class="token punctuation">,</span>
    loadingComponent<span class="token punctuation">:</span> LoadingComponent
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>此外，与 2.x 不同，<code>loader</code> 函数不再接收 <code>resolve</code> 和 <code>reject</code> 参数，且必须始终返回 <code>Promise</code>。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x 版本</span>
<span class="token keyword">const</span> oldAsyncComponent <span class="token operator">=</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">/* ... */</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// 3.x 版本</span>
<span class="token keyword">const</span> asyncComponent <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">/* ... */</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>
<p>更多有关异步组件用法的详细信息，请参阅：<br><a href="https://cn.vuejs.org/guide/components/async.html#basic-usage" target="_blank" rel="noopener">指南：异步组件</a></p>
<h3 id="16、emits-选项-新增"><a href="#16、emits-选项-新增" class="headerlink" title="16、emits 选项(新增)"></a>16、emits 选项(新增)</h3><p>Vue 3 现在提供一个 <code>emits</code> 选项，和现有的 <code>props</code> 选项类似。这个选项可以用来定义一个组件可以向其父组件触发的事件。</p>
<p>在 Vue 2 中，你可以定义一个组件可接收的 <code>prop</code>，但是你无法声明它可以触发哪些事件，</p>
<p>在 Vue 3 中，和 <code>prop</code> 类似，现在可以通过 <code>emits</code> 选项来定义组件可触发的事件。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$emit(<span class="token punctuation">'</span>accepted<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    emits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'accepted'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<blockquote>
<p>强烈建议使用 <code>emits</code> 记录每个组件所触发的所有事件。<br>这尤为重要，因为我们移除了 <code>.native</code> 修饰符。任何未在 <code>emits</code> 中声明的事件监听器都会被算入组件的 <code>$attrs</code>，并将默认绑定到组件的根节点上。</p>
</blockquote>
<p>对于向其父组件透传原生事件的组件来说，这会导致有两个事件被触发：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 子组件 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$emit(<span class="token punctuation">'</span>click<span class="token punctuation">'</span>, $event)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    emits<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// 不声明事件</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>当一个父级组件拥有 <code>click</code> 事件的监听器时：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>handleClick<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-button</span><span class="token punctuation">></span></span></code></pre>
<p>该事件现在会被触发两次:</p>
<ul>
<li><p>一次来自 <code>$emit()</code>。</p>
</li>
<li><p>另一次来自应用在根元素上的原生事件监听器。<br>现在你有两个选项：</p>
</li>
<li><p>正确地声明 <code>click</code> 事件。当你真的在 <my-button> 的事件处理器上加入了一些逻辑时，这会很有用。</my-button></p>
</li>
<li><p>移除透传的事件，因为现在父组件可以很容易地监听原生事件，而不需要添加 <code>.native</code>。适用于你只想透传这个事件。</p>
</li>
</ul>
<h3 id="17、移除-listeners"><a href="#17、移除-listeners" class="headerlink" title="17、移除$listeners"></a>17、移除$listeners</h3><p><code>$listeners</code> 对象在 Vue 3 中已被移除。事件监听器现在是<code>$attrs</code> 的一部分：</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span>
  text<span class="token punctuation">:</span> <span class="token string">'这是一个 attribute'</span><span class="token punctuation">,</span>
  onClose<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'close 事件被触发'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="18、-attrs-包含-class-amp-style"><a href="#18、-attrs-包含-class-amp-style" class="headerlink" title="18、$attrs 包含 class &amp; style"></a>18、$attrs 包含 class &amp; style</h3><p><code>$attrs</code> 现在包含了所有传递给组件的 attribute，包括 <code>class</code> 和 <code>style</code>。</p>
<h4 id="18-1-Vue2-x-行为"><a href="#18-1-Vue2-x-行为" class="headerlink" title="18.1 Vue2.x 行为"></a>18.1 Vue2.x 行为</h4><p>Vue 2 的虚拟 DOM 实现对 <code>class</code> 和 <code>style</code> attribute 有一些特殊处理。因此，与其它所有 attribute 不一样，它们没有被包含在 <code>$attrs</code> 中。</p>
<p>上述行为在使用 <code>inheritAttrs: false</code> 时会产生副作用：</p>
<p><code>$attrs</code> 中的 <code>attribute</code> 将不再被自动添加到根元素中，而是由开发者决定在哪添加。<br>但是 <code>class</code> 和 <code>style</code> 不属于 <code>$attrs</code>，它们仍然会被应用到组件的根元素中：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$attrs<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    inheritAttrs<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>像这样使用时：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-id<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-class<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-component</span><span class="token punctuation">></span></span></code></pre>
<p>将生成以下 HTML：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- class 和 style 不属于 $attrs，它们仍然会被应用到组件的根元素中 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-class<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-id<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre>
<h4 id="18-2-Vue3-x-行为"><a href="#18-2-Vue3-x-行为" class="headerlink" title="18.2 Vue3.x 行为"></a>18.2 Vue3.x 行为</h4><p><code>$attrs</code> 包含了所有的 attribute，这使得把它们全部应用到另一个元素上变得更加容易了。现在上面的示例将生成以下 HTML：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-id<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>my-class<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></code></pre>
<blockquote>
<p>在使用了 <code>inheritAttrs: false</code> 的组件中，请确保样式仍然符合预期。如果你之前依赖了 <code>class</code> 和 <code>style</code> 的特殊行为，那么一些视觉效果可能会遭到破坏，因为这些 attribute 现在可能被应用到了另一个元素中。</p>
</blockquote>
<h3 id="19、渲染函数-API"><a href="#19、渲染函数-API" class="headerlink" title="19、渲染函数 API"></a>19、渲染函数 API</h3><blockquote>
<p>此更改不会影响 <code>&lt;template&gt;</code> 用户。</p>
</blockquote>
<ul>
<li><code>h</code> 现在是全局导入，而不是作为参数传递给渲染函数</li>
<li>更改渲染函数参数，使其在有状态组件和函数组件的表现更加一致</li>
<li><code>VNode</code> 现在有一个扁平的 prop 结构</li>
</ul>
<h4 id="19-1-渲染函数参数"><a href="#19-1-渲染函数参数" class="headerlink" title="19.1 渲染函数参数"></a>19.1 渲染函数参数</h4><p>在 2.x 中，<code>render</code> 函数会自动接收 <code>h</code> 函数 (它是 <code>createElement</code> 的惯用别名) 作为参数：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Vue 2 渲染函数示例</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>在 3.x 中，<code>h</code> 函数现在是全局导入的，而不是作为参数自动传递。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// Vue 3 渲染函数示例</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="19-2-VNode-Prop-格式化"><a href="#19-2-VNode-Prop-格式化" class="headerlink" title="19.2 VNode Prop 格式化"></a>19.2 VNode Prop 格式化</h4><p>在 2.x 中，<code>domProps</code> 包含 <code>VNode</code> prop 中的嵌套列表：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x</span>
<span class="token punctuation">{</span>
  staticClass<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
  <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'is-outlined'</span><span class="token punctuation">:</span> isOutlined <span class="token punctuation">}</span><span class="token punctuation">,</span>
  staticStyle<span class="token punctuation">:</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'#34495E'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  style<span class="token punctuation">:</span> <span class="token punctuation">{</span> backgroundColor<span class="token punctuation">:</span> buttonColor <span class="token punctuation">}</span><span class="token punctuation">,</span>
  attrs<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'submit'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  domProps<span class="token punctuation">:</span> <span class="token punctuation">{</span> innerHTML<span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  on<span class="token punctuation">:</span> <span class="token punctuation">{</span> click<span class="token punctuation">:</span> submitForm <span class="token punctuation">}</span><span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> <span class="token string">'submit-button'</span>
<span class="token punctuation">}</span></code></pre>
<p>在 3.x 中，整个 <code>VNode</code> prop 的结构都是扁平的。使用上面的例子，来看看它现在的样子。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 3.x 语法</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'is-outlined'</span><span class="token punctuation">:</span> isOutlined <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  style<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">'#34495E'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> backgroundColor<span class="token punctuation">:</span> buttonColor <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  id<span class="token punctuation">:</span> <span class="token string">'submit'</span><span class="token punctuation">,</span>
  innerHTML<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  onClick<span class="token punctuation">:</span> submitForm<span class="token punctuation">,</span>
  key<span class="token punctuation">:</span> <span class="token string">'submit-button'</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="19-3-注册组件"><a href="#19-3-注册组件" class="headerlink" title="19.3 注册组件"></a>19.3 注册组件</h4><p>在 2.x 中，注册一个组件后，把组件名作为字符串传递给渲染函数的第一个参数，它可以正常地工作：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'button-counter'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            count<span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
        &lt;button @click="count++">
        Clicked {{ count }} times.
        &lt;/button>
    `</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'button-counter'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>在 3.x 中，由于 <code>VNode</code> 是上下文无关的，不能再用字符串 ID 隐式查找已注册组件。取而代之的是，需要使用一个导入的 <code>resolveComponent</code> 方法：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 3.x</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> resolveComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> ButtonCounter <span class="token operator">=</span> <span class="token function">resolveComponent</span><span class="token punctuation">(</span><span class="token string">'button-counter'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span>ButtonCounter<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="20、-插槽统一"><a href="#20、-插槽统一" class="headerlink" title="20、 插槽统一"></a>20、 插槽统一</h3><p><code>this.$slots</code> 现在将插槽作为函数公开。移除 <code>this.$scopedSlots</code></p>
<p>当使用渲染函数，即 <code>h</code> 时，2.x 曾经在内容节点上定义 <code>slot</code> 数据 property。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x 语法</span>
<span class="token function">h</span><span class="token punctuation">(</span>LayoutComponent<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> slot<span class="token punctuation">:</span> <span class="token string">'header'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> slot<span class="token punctuation">:</span> <span class="token string">'content'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<p>可以使用以下语法引用作用域插槽：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x 语法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span>header</code></pre>
<p>在 3.x 中，插槽以<strong>对象</strong>的形式定义为当前节点的子节点：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 3.x Syntax</span>
<span class="token function">h</span><span class="token punctuation">(</span>LayoutComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    header<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>header<span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>当你需要以编程方式引用作用域插槽时，它们现在被统一到 <code>$slots</code> 选项中了。</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// 2.x 语法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span>header

<span class="token comment" spellcheck="true">// 3.x 语法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<blockquote>
<p>大部分更改已经在 2.6 中发布。因此，迁移可以一步到位：</p>
</blockquote>
<ol>
<li>在 3.x 中，将所有 <code>this.$scopedSlots</code> 替换为 <code>this.$slots</code>。</li>
<li>将所有 <code>this.$slots.mySlot</code> 替换为 <code>this.$slots.mySlot()</code>。</li>
</ol>
<h3 id="21、按键修饰符"><a href="#21、按键修饰符" class="headerlink" title="21、按键修饰符"></a>21、按键修饰符</h3><ol>
<li>不再支持使用数字 (即键码) 作为 v-on 修饰符（现在建议对任何要用作修饰符的键使用 kebab-cased (短横线) 名称-<br><code>&lt;input v-on:keyup.page-down="nextPage"&gt;</code>）</li>
<li>不再支持 <code>config.keyCodes</code>自定义别名</li>
</ol>
<p>在 Vue 2 中，keyCodes 可以作为修改 v-on 方法的一种方式。</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 键码版本 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.13</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 别名版本 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.enter</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>此外，也可以通过全局的 <code>config.keyCodes</code> 选项定义自己的别名。</p>
<pre class=" language-js"><code class="language-js">Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>keyCodes <span class="token operator">=</span> <span class="token punctuation">{</span>
    f1<span class="token punctuation">:</span> <span class="token number">112</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 键码版本 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.112</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showHelpText<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 自定义别名版本 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.f1</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showHelpText<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>从 <code>KeyboardEvent.keyCode</code> 已被废弃开始，Vue 3 继续支持这一点就不再有意义了。</p>
<p>因此，现在建议对任何要用作修饰符的键使用 kebab-cased (短横线) 名称。</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- Vue 3 在 v-on 上使用按键修饰符 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keyup.page-down</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nextPage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token comment" spellcheck="true">&lt;!-- 同时匹配 q 和 Q --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keypress.q</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>quit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<p>对于某些标点符号键，可以直接把它们包含进去，以<code>,</code>键为例：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">v-on:</span>keypress.,</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>commaPress<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<p>语法的限制导致某些特定字符无法被匹配，比如 <code>"</code>、<code>'</code>、<code>/</code>、<code>=</code>、<code>&gt;</code> 和 <code>.</code>。对于这些字符，你应该在监听器内使用 <code>event.key</code> 代替。</p>
<h3 id="22、-children-移除"><a href="#22、-children-移除" class="headerlink" title="22、$children 移除"></a>22、$children 移除</h3><p><code>$children</code> 实例 property 已从 Vue 3.0 中移除，不再支持。如果你需要访问子组件实例，使用模板引用($ref)。</p>
<h3 id="23、propsData-移除"><a href="#23、propsData-移除" class="headerlink" title="23、propsData 移除"></a>23、propsData 移除</h3><p><code>propsData</code> 选项之前用于在创建 Vue 实例的过程中传入 <code>prop</code>，现在它被移除了。如果想为 Vue 3 应用的根组件传入 <code>prop</code>，请使用 <code>createApp</code> 的第二个参数。</p>
<p>在 2.x 中，我们可以在创建 Vue 实例的时候传入 prop：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> Comp <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  template<span class="token punctuation">:</span> <span class="token string">'&lt;div>{{ username }}&lt;/div>'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Comp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  propsData<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">:</span> <span class="token string">'Evan'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p><code>propsData</code> 选项已经被移除。如果你需要在实例创建时向根组件传入 <code>prop</code>，你应该使用 <code>createApp</code> 的第二个参数：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        template<span class="token punctuation">:</span> <span class="token string">'&lt;div>{{ username }}&lt;/div>'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> username<span class="token punctuation">:</span> <span class="token string">'Evan'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span></code></pre>
<h3 id="24、被挂载的应用不会替换元素"><a href="#24、被挂载的应用不会替换元素" class="headerlink" title="24、被挂载的应用不会替换元素"></a>24、被挂载的应用不会替换元素</h3><p>在 Vue 2.x 中，当挂载一个具有 <code>template</code> 的应用时，被渲染的内容会<strong>替换</strong>我们要挂载的目标元素。</p>
<p>我们为 <code>new Vue()</code> 或 <code>$mount</code> 传入一个 <code>HTML</code> 元素选择器：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
        &lt;div id="rendered">{{ message }}&lt;/div>
    `</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 或</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
        &lt;div id="rendered">{{ message }}&lt;/div>
    `</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></code></pre>
<p>我们把应用挂载到拥有匹配被传入选择器 (在这个例子中是 <code>id="app"</code>) 的 div 的页面时：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        Some app content
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p>在渲染结果中，上面提及的 <code>div</code> 将会被应用所渲染的内容替换：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rendered<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello Vue!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<p>在 Vue 3.x 中，被渲染的应用会作为子元素<strong>插入</strong>，从而<strong>替换</strong>目标元素的 <code>innerHTML</code>。</p>
<p>当我们挂载一个应用时，其渲染内容会替换我们传递给 <code>mount</code> 的元素的 <code>innerHTML</code>：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> app <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            message<span class="token punctuation">:</span> <span class="token string">'Hello Vue!'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`
        &lt;div id="rendered">{{ message }}&lt;/div>
    `</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></code></pre>
<p>当这个应用挂载到拥有匹配 <code>id="app"</code> 的 <code>div</code> 的页面时，结果会是：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span> <span class="token attr-name">data-v-app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rendered<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Hello Vue!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code></pre>
<h3 id="25、Props-的-default-工厂函数不再可以访问-this-上下文"><a href="#25、Props-的-default-工厂函数不再可以访问-this-上下文" class="headerlink" title="25、Props 的 default 工厂函数不再可以访问 this 上下文"></a>25、Props 的 <code>default</code> 工厂函数不再可以访问 <code>this</code> 上下文</h3><p>生成 <code>prop</code> 默认值的工厂函数不再能访问 <code>this</code>。</p>
<p>取而代之的是：</p>
<p>组件接收到的原始 <code>prop</code> 将作为<strong>参数</strong>传递给默认函数；</p>
<p>inject API 可以在默认函数中使用。</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        theme<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">default</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// `props` 是传递给组件的、</span>
                <span class="token comment" spellcheck="true">// 在任何类型/默认强制转换之前的原始值，</span>
                <span class="token comment" spellcheck="true">// 也可以使用 `inject` 来访问注入的 property</span>
                <span class="token keyword">return</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'theme'</span><span class="token punctuation">,</span> <span class="token string">'default-theme'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="26、transition"><a href="#26、transition" class="headerlink" title="26、transition"></a>26、transition</h3><h4 id="26-1-过渡的-class-名更改"><a href="#26-1-过渡的-class-名更改" class="headerlink" title="26.1 过渡的 class 名更改"></a>26.1 过渡的 class 名更改</h4><p>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code>、过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code>。</p>
<p>在 v2.1.8 版本之前，每个过渡方向都有两个过渡类：<strong>初始状态</strong>与<strong>激活状态</strong>。</p>
<p>在 v2.1.8 版本中，引入了 <code>v-enter-to</code> 来定义 <code>enter</code> 或 <code>leave</code> 变换之间的过渡动画插帧。</p>
<p>然而，为了向下兼容，并没有变动 <code>v-enter</code> 类名：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.v-enter</span>,
<span class="token class">.v-leave-to</span> </span><span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.v-leave</span>,
<span class="token class">.v-enter-to</span> </span><span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这样做会带来很多困惑，类似 <code>enter</code> 和 <code>leave</code> 含义过于宽泛，并且没有遵循类名钩子的<strong>命名约定</strong>。</p>
<p>在Vue3 中，为了更加明确易读，我们现在将这些初始状态重命名为：</p>
<pre class=" language-css"><code class="language-css"><span class="token selector"><span class="token class">.v-enter-from</span>,
<span class="token class">.v-leave-to</span> </span><span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.v-leave-from</span>,
<span class="token class">.v-enter-to</span> </span><span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><img src="https://v3-migration.vuejs.org/images/transitions.svg" alt=""></p>
<p><code>&lt;transition&gt;</code>组件的相关 <code>prop</code> 名称也发生了变化：</p>
<ul>
<li><code>leave-class</code> 已经被重命名为 <code>leave-from-class</code> (在渲染函数或 JSX 中可以写为：<code>leaveFromClass</code>)</li>
<li><code>enter-class</code> 已经被重命名为 <code>enter-from-class</code> (在渲染函数或 JSX 中可以写为：<code>enterFromClass</code>)</li>
</ul>
<h4 id="26-2-Transition-作为根节点"><a href="#26-2-Transition-作为根节点" class="headerlink" title="26.2 Transition 作为根节点"></a>26.2 <code>Transition</code> 作为根节点</h4><p>当使用 <code>&lt;transition&gt;</code>作为根结点的组件从外部被切换时将不再触发过渡效果。</p>
<p>在 Vue 2 中，通过使用 <code>&lt;transition&gt;</code> 作为一个组件的根节点，过渡效果存在从组件外部触发的可能性：</p>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 模态组件 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 用法 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modal</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showModal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modal</span><span class="token punctuation">></span></span></code></pre>
<p>切换 <code>showModal</code> 的值将会在模态组件内部触发一个<strong>过渡效果</strong>。</p>
<p>这是无意为之的，并<strong>不是设计效果</strong>。一个 <code>&lt;transition&gt;</code> 原本是希望被其子元素触发的，而不是 <code>&lt;transition&gt;</code> 自身。</p>
<p>这个怪异的现象现在被移除了。</p>
<p>换做向组件传递一个 <code>prop</code> 就可以达到类似的效果：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>show<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'show'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<pre class=" language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!-- 用法 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modal</span> <span class="token attr-name">:show</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showModal<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modal</span><span class="token punctuation">></span></span></code></pre>
<h4 id="26-3-Transition-Group-根元素"><a href="#26-3-Transition-Group-根元素" class="headerlink" title="26.3 Transition Group 根元素"></a>26.3 Transition Group 根元素</h4><p><code>&lt;transition-group&gt;</code> 不再默认渲染根元素，但仍然可以用 <code>tag</code> attribute 创建根元素。</p>
<p>在 Vue 2 中，<code>&lt;transition-group&gt;</code> 像其它自定义组件一样，需要一个根元素。默认的根元素是一个 <code>&lt;span&gt;</code>，但可以通过 <code>tag</code> attribute 定制。</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ul<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item in items<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        {{ item }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">></span></span></code></pre>
<p>在 Vue 3 中，我们有了片段的支持，因此组件不再需要根节点。所以，<code>&lt;transition-group&gt;</code> 不再默认渲染根节点。</p>
<p>如果像上面的示例一样，已经在 Vue 2 代码中定义了 <code>tag</code> attribute，那么一切都会和之前一样<br>如果没有定义 <code>tag</code> attribute，而且样式或其它行为依赖于 <code>&lt;span&gt;</code> 根元素的存在才能正常工作，那么只需将 <code>tag="span"</code> 添加到 <code>&lt;transition-group&gt;</code>：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition-group</span> <span class="token attr-name">tag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>span<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment" spellcheck="true">&lt;!-- --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition-group</span><span class="token punctuation">></span></span></code></pre>
<h3 id="27、VNode-生命周期事件"><a href="#27、VNode-生命周期事件" class="headerlink" title="27、VNode 生命周期事件"></a>27、VNode 生命周期事件</h3><p>在 Vue 2 中，我们可以通过事件来监听组件生命周期中的关键阶段。这些事件名都是以 <code>hook:</code> <strong>前缀</strong>开头，并跟随相应的生命周期钩子的名字。</p>
<p>在 Vue 3 中，这个<strong>前缀</strong>已被更改为 <code>vue:</code>。额外地，这些事件现在也可用于 <code>HTML</code> 元素，和在组件上的用法一样。</p>
<p><code>@hook:updated="onUpdated"</code> =&gt; <code>@vue:updated="onUpdated"</code></p>
<p><code>destroyed</code> 生命周期选项被重命名为 <code>unmounted</code><br><code>beforeDestroy</code> 生命周期选项被重命名为 <code>beforeUnmount</code></p>
<h3 id="28、Watch-侦听数组"><a href="#28、Watch-侦听数组" class="headerlink" title="28、Watch 侦听数组"></a>28、Watch 侦听数组</h3><p>当侦听一个数组时，只有当<strong>数组被替换</strong>时才会触发回调。如果你需要在<strong>数组被改变</strong>时触发回调，<strong>必须</strong>指定 <code>deep</code> 选项。</p>
<h3 id="29、-destroy-实例方法"><a href="#29、-destroy-实例方法" class="headerlink" title="29、$destroy 实例方法"></a>29、<code>$destroy</code> 实例方法</h3><p>用户不应该再手动管理单个 Vue 组件的生命周期。</p>
<h3 id="30、全局函数-set-和-delete"><a href="#30、全局函数-set-和-delete" class="headerlink" title="30、全局函数 set 和 delete"></a>30、全局函数 set 和 delete</h3><p>全局函数 <code>set</code> 和 <code>delete</code> 以及实例方法 <code>$set</code> 和<code>$delete</code>。基于代理的变化检测已经不再需要它们了</p>
<h3 id="31、样式穿透"><a href="#31、样式穿透" class="headerlink" title="31、样式穿透"></a>31、样式穿透</h3><p>在vue3.0中，<code>/deep/</code>以及<code>::v-deep</code>已经不被推荐，推荐使用 <code>:deep()</code>替代</p>
<pre class=" language-css"><code class="language-css"><span class="token comment" spellcheck="true">/* Vue 2.0 写法 */</span>
<span class="token selector"><span class="token pseudo-element">::v-deep</span> <span class="token class">.carousel-btn.prev</span> </span><span class="token punctuation">{</span>
    <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">270</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* Vue 3.0 更改为以下写法 */</span>
<span class="token selector"><span class="token pseudo-class">:deep(.carousel-btn.prev)</span> </span><span class="token punctuation">{</span>
    <span class="token property">left</span><span class="token punctuation">:</span> <span class="token number">270</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">/* 或是 */</span>
<span class="token selector"><span class="token pseudo-class">:deep()</span> </span><span class="token punctuation">{</span>
    <span class="token selector"><span class="token class">.class</span> </span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>有关<a href="https://blog.tianyichuxin.com/2021/06/10894.html#toc-heading-12">Vue 3 ::v-deep usage as a combinator has been deprecated. Use ::v-deep() instead</a>的内容，推荐使用<code>:deep()</code></p>
<h2 id="二、Vue3-新增内容"><a href="#二、Vue3-新增内容" class="headerlink" title="二、Vue3 新增内容"></a>二、Vue3 新增内容</h2><h3 id="1、组合式-API"><a href="#1、组合式-API" class="headerlink" title="1、组合式 API"></a>1、组合式 API</h3><p>详情参考：<a href="https://cn.vuejs.org/guide/extras/composition-api-faq.html" target="_blank" rel="noopener">组合式 API</a></p>
<h3 id="2、单文件组件中的组合式-API-语法糖-lt-script-setup-gt"><a href="#2、单文件组件中的组合式-API-语法糖-lt-script-setup-gt" class="headerlink" title="2、单文件组件中的组合式 API 语法糖 (<script setup>)"></a>2、单文件组件中的组合式 API 语法糖 (<code>&lt;script setup&gt;</code>)</h3><p><code>&lt;script setup&gt;</code> 是在单文件组件 (<code>SFC</code>) 中使用<strong>组合式 API</strong> 的编译时<strong>语法糖</strong>。当同时使用 <code>SFC</code> 与<strong>组合式 API</strong> 时该语法是<strong>默认推荐</strong>。相比于普通的 <code>&lt;script&gt;</code> 语法，它具有更多优势：</p>
<ul>
<li>更少的样板内容，更简洁的代码。</li>
<li>能够使用纯 <code>TypeScript</code> 声明 <code>props</code> 和自定义事件。</li>
<li>更好的运行时性能 (其模板会被编译成同一作用域内的渲染函数，避免了渲染上下文代理对象)。</li>
<li>更好的 <code>IDE</code> 类型推导性能 (减少了语言服务器从代码中抽取类型的工作)。</li>
</ul>
<h4 id="2-1-基本语法"><a href="#2-1-基本语法" class="headerlink" title="2.1 基本语法"></a>2.1 基本语法</h4><pre class=" language-js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello script setup'</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>
<p>里面的代码会被编译成组件 <code>setup()</code> 函数的内容。这意味着与普通的 <code>&lt;script&gt;</code> 只在组件被首次引入的时候执行一次不同，<code>&lt;script setup&gt;</code> 中的代码会<strong>在每次组件实例被创建的时候执行</strong>。</p>
<h4 id="2-2-顶层的绑定会被暴露给模板"><a href="#2-2-顶层的绑定会被暴露给模板" class="headerlink" title="2.2 顶层的绑定会被暴露给模板"></a>2.2 顶层的绑定会被暴露给模板</h4><p>当使用 <code>&lt;script setup&gt;</code> 的时候，任何在 <code>&lt;script setup&gt;</code> 声明的顶层的绑定 (包括变量，函数声明，以及 <code>import</code> 导入的内容) 都能在模板中直接使用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token comment" spellcheck="true">// 变量</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'Hello!'</span>

<span class="token comment" spellcheck="true">// 函数</span>
<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p><code>import</code> 导入的内容也会以同样的方式暴露。这意味着我们可以在模板表达式中直接使用导入的 <code>helper</code> 函数，而不需要通过 <code>methods</code> 选项来暴露它：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> capitalize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./helpers'</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{{ capitalize('hello') }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h4 id="2-3-响应式"><a href="#2-3-响应式" class="headerlink" title="2.3 响应式"></a>2.3 响应式</h4><p>响应式状态需要明确使用<a href="https://cn.vuejs.org/api/reactivity-core.html" target="_blank" rel="noopener">响应式 API</a> 来创建。和 <code>setup()</code> 函数的返回值一样，<code>ref</code> 在模板中使用的时候会自动解包：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>count++<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h4 id="2-4-使用组件"><a href="#2-4-使用组件" class="headerlink" title="2.4 使用组件"></a>2.4 使用组件</h4><p><code>&lt;script setup&gt;</code>范围里的值也能被直接作为自定义组件的标签名使用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'./MyComponent.vue'</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MyComponent</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>这里 <code>MyComponent</code> 应当被理解为像是<strong>在引用一个变量</strong>。如果你使用过 JSX，此处的心智模型是类似的。其 <code>kebab-case</code> 格式的 <code>&lt;my-component&gt;</code> 同样能在模板中使用</p>
<p>不过，我们强烈建议使用 <code>PascalCase</code> 格式以保持一致性。同时这也有助于区分原生的自定义元素。</p>
<h5 id="2-4-1-动态组件"><a href="#2-4-1-动态组件" class="headerlink" title="2.4.1 动态组件"></a>2.4.1 动态组件</h5><p>由于组件是通过变量引用而不是基于字符串组件名注册的，在 <code>&lt;script setup&gt;</code> 中要使用动态组件的时候，应该使用动态的 <code>:is</code> 来绑定：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">'./Foo.vue'</span>
<span class="token keyword">import</span> Bar <span class="token keyword">from</span> <span class="token string">'./Bar.vue'</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Foo<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>someCondition ? Foo : Bar<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>请注意组件是如何在三元表达式中被当做变量使用的。</p>
<h5 id="2-4-2-递归组件"><a href="#2-4-2-递归组件" class="headerlink" title="2.4.2 递归组件"></a>2.4.2 递归组件</h5><p>一个单文件组件可以通过它的文件名被其自己所引用。例如：名为 <code>FooBar.vue</code> 的组件可以在其模板中用 <code>&lt;FooBar/&gt;</code> 引用它自己。</p>
<p>请注意这种方式<strong>相比于导入的组件优先级更低</strong>。如果有具名的导入和组件自身推导的名字冲突了，可以为导入的组件添加别名：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> FooBar <span class="token keyword">as</span> FooBarChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./components'</span></code></pre>
<h5 id="2-4-3-命名空间组件"><a href="#2-4-3-命名空间组件" class="headerlink" title="2.4.3 命名空间组件"></a>2.4.3 命名空间组件</h5><p>可以使用带 <code>.</code> 的组件标签，例如 <code>&lt;Foo.Bar&gt;</code> 来引用嵌套在对象属性中的组件。这在需要从单个文件中导入多个组件的时候非常有用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Form <span class="token keyword">from</span> <span class="token string">'./form-components'</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Form.Input</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Form.Label</span><span class="token punctuation">></span></span>label<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Form.Label</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Form.Input</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<h4 id="2-5-使用自定义指令"><a href="#2-5-使用自定义指令" class="headerlink" title="2.5 使用自定义指令"></a>2.5 使用自定义指令</h4><p>全局注册的自定义指令将正常工作。</p>
<p>本地的自定义指令在 <code>&lt;script setup&gt;</code> 中<strong>不需要显式注册</strong>，但他们必须遵循 <code>vNameOfDirective</code> 这样的命名规范：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">const</span> vMyDirective <span class="token operator">=</span> <span class="token punctuation">{</span>
    beforeMount<span class="token punctuation">:</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 在元素上做些操作</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-my-directive</span><span class="token punctuation">></span></span>This is a Heading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code></pre>
<p>如果指令是从别处导入的，可以通过重命名来使其符合命名规范：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> myDirective <span class="token keyword">as</span> vMyDirective <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./MyDirective.js'</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h4 id="2-6-defineProps-和-defineEmits"><a href="#2-6-defineProps-和-defineEmits" class="headerlink" title="2.6 defineProps() 和 defineEmits()"></a>2.6 defineProps() 和 defineEmits()</h4><p>为了在声明 <code>props</code> 和 <code>emits</code> 选项时获得完整的类型推导支持，我们可以使用 <code>defineProps</code> 和 <code>defineEmits</code> API，它们将自动地在 <code>&lt;script setup&gt;</code> 中可用：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// setup 代码</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<ul>
<li><code>defineProps</code> 和 <code>defineEmits</code> 都是只能在 <code>&lt;script setup&gt;</code> 中使用的<strong>编译器宏</strong>。他们不需要导入，且会随着 <code>&lt;script setup&gt;</code> 的处理过程一同被编译掉。</li>
<li><code>defineProps</code> 接收与 <code>props</code> 选项相同的值，<code>defineEmits</code> 接收与 <code>emits</code> 选项相同的值。</li>
<li><code>defineProps</code> 和 <code>defineEmits</code> 在选项传入后，会提供恰当的类型推导。</li>
<li>传入到 <code>defineProps</code> 和 <code>defineEmits</code> 的选项会从 setup 中提升到模块的作用域。因此，传入的选项不能引用在 setup 作用域中声明的局部变量。这样做会引起编译错误。但是，它<em>可以</em>引用导入的绑定，因为它们也在模块作用域内。</li>
</ul>
<h4 id="2-7-defineExpose"><a href="#2-7-defineExpose" class="headerlink" title="2.7 defineExpose()"></a>2.7 defineExpose()</h4><p>使用 <code>&lt;script setup&gt;</code> 的组件是默认关闭的——即通过模板引用或者 <code>$parent</code> 链获取到的组件的公开实例，不会暴露任何在 <code>&lt;script setup&gt;</code> 中声明的绑定。</p>
<p>可以通过 <code>defineExpose</code> 编译器宏来显式指定在 <code>&lt;script setup&gt;</code> 组件中要暴露出去的属性：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">,</span>
    b
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>当父组件通过模板引用的方式获取到当前组件的实例，获取到的实例会像这样 <code>{ a: number, b: number }</code> (ref 会和在普通实例中一样被自动解包)</p>
<h4 id="2-8-useSlots-和-useAttrs"><a href="#2-8-useSlots-和-useAttrs" class="headerlink" title="2.8 useSlots() 和 useAttrs()"></a>2.8 useSlots() 和 useAttrs()</h4><p>在 <code>&lt;script setup&gt;</code> 使用 <code>slots</code> 和 <code>attrs</code> 的情况应该是相对来说<strong>较为罕见</strong>的，因为可以在模板中直接通过 <code>$slots</code> 和 <code>$attrs</code> 来访问它们。在你的确需要使用它们的罕见场景中，可以分别用 <code>useSlots</code> 和 <code>useAttrs</code> 两个辅助函数：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSlots<span class="token punctuation">,</span> useAttrs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> slots <span class="token operator">=</span> <span class="token function">useSlots</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">useAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p><code>useSlots</code> 和 <code>useAttrs</code> 是真实的运行时函数，它的返回与 <code>setupContext.slots</code> 和 <code>setupContext.attrs</code> 等价。它们同样也能在普通的组合式 API 中使用。</p>
<h4 id="2-9-与普通的-lt-script-gt-一起使用"><a href="#2-9-与普通的-lt-script-gt-一起使用" class="headerlink" title="2.9 与普通的 <script> 一起使用"></a>2.9 与普通的 <code>&lt;script&gt;</code> 一起使用</h4><p><code>&lt;script setup&gt;</code> 可以和普通的 <code>&lt;script&gt;</code> 一起使用。普通的 <code>&lt;script&gt;</code> 在有这些需要的情况下或许会被使用到：</p>
<ul>
<li>声明无法在 `` 中声明的选项，例如 <code>inheritAttrs</code> 或插件的自定义选项。</li>
<li>声明模块的具名导出 (named exports)。</li>
<li>运行只需要在模块作用域执行一次的副作用，或是创建单例对象。</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token comment" spellcheck="true">// 普通 &lt;script>, 在模块作用域下执行 (仅一次)</span>
<span class="token function">runSideEffectOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 声明额外的选项</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    inheritAttrs<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    customOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token comment" spellcheck="true">// 在 setup() 作用域中执行 (对每个实例皆如此)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>在同一组件中将 <code>&lt;script setup&gt;</code> 与 <code>&lt;script&gt;</code> 结合使用的支持仅限于上述情况。具体来说：</p>
<ul>
<li><strong>不要</strong>为已经可以用 <code>&lt;script setup&gt;</code> 定义的选项使用单独的 <code>&lt;script&gt;</code> 部分，如 <code>props</code> 和 <code>emits</code>。</li>
<li>在 <code>&lt;script setup&gt;</code> 中创建的变量不会作为属性添加到组件实例中，这使得它们无法从选项式 API 中访问。我们强烈反对以这种方式混合 API。</li>
</ul>
<p>如果你发现自己处于以上任一不被支持的场景中，那么你应该考虑切换到一个显式的 <a href="https://cn.vuejs.org/api/composition-api-setup.html" target="_blank" rel="noopener"><code>setup()</code></a> 函数，而不是使用 <code>&lt;script setup&gt;</code>。</p>
<h4 id="2-10-顶层-await"><a href="#2-10-顶层-await" class="headerlink" title="2.10 顶层 await"></a>2.10 顶层 <code>await</code></h4><p><code>&lt;script setup&gt;</code> 中可以使用顶层 <code>await</code>。结果代码会被编译成 <code>async setup()</code>：</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">></span></span><span class="token script language-javascript">
<span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/api/post/1`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<h3 id="3、常用API"><a href="#3、常用API" class="headerlink" title="3、常用API"></a>3、常用API</h3><h4 id="ref、reactive"><a href="#ref、reactive" class="headerlink" title="ref、reactive"></a>ref、reactive</h4><ul>
<li><p>ref：将<strong>单个值</strong>转成响应式对象，如：数字0、1，字符串”你好”等</p>
</li>
<li><p>reactive：将<strong>对象</strong>转成响应式对象，如：<code>{name:'张三',age:18}</code></p>
</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">let</span> height <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">'张三'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span>
    sex<span class="token punctuation">:</span><span class="token string">'男'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="toRef、toRefs"><a href="#toRef、toRefs" class="headerlink" title="toRef、toRefs"></a>toRef、toRefs</h4><ul>
<li>toRef：将对象中的某个属性单独转成响应式对象，并和原来的值关联</li>
<li>toRefs：将对象中的所有属性单独转成响应式对象，并和原来的值关联</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span></code></pre>
<h4 id="watch，computed，watchEffect"><a href="#watch，computed，watchEffect" class="headerlink" title="watch，computed，watchEffect"></a>watch，computed，watchEffect</h4><ul>
<li>watch：监视函数，被监视的属性发生变化时调用</li>
<li>watchEffect：监视被使用的属性是否发生变化</li>
<li>computed：计算属性，返回被计算后的值</li>
</ul>
<p><strong>计算属性调试</strong></p>
<p>我们可以向 <code>computed()</code> 传入第二个参数，是一个包含了 <code>onTrack</code> 和 <code>onTrigger</code> 两个回调函数的对象：</p>
<ul>
<li><code>onTrack</code> 将在响应属性或引用作为依赖项被跟踪时被调用。</li>
<li><code>onTrigger</code> 将在侦听器回调被依赖项的变更触发时被调用。</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">onTrack</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 当 count.value 被追踪为依赖时触发</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onTrigger</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 当 count.value 被更改时触发</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 访问 plusOne，会触发 onTrack</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>plusOne<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// 更改 count.value，应该会触发 onTrigger</span>
count<span class="token punctuation">.</span>value<span class="token operator">++</span></code></pre>
<blockquote>
<p>tips：计算属性的 <code>onTrack</code> 和 <code>onTrigger</code> 选项仅会在开发模式下工作。</p>
</blockquote>
<p><strong>侦听器调试</strong></p>
<p>和 <code>computed()</code> 类似，侦听器也支持 <code>onTrack</code> 和 <code>onTrigger</code> 选项： </p>
<pre class=" language-js"><code class="language-js"><span class="token function">watch</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">onTrack</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onTrigger</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">onTrack</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onTrigger</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<blockquote>
<p>tips：侦听器的 <code>onTrack</code> 和 <code>onTrigger</code> 选项仅会在开发模式下工作。</p>
</blockquote>
<h3 id="4、不常用API"><a href="#4、不常用API" class="headerlink" title="4、不常用API"></a>4、不常用API</h3><h4 id="shallowRef、shallowReactive、readonly、shallowReadonly"><a href="#shallowRef、shallowReactive、readonly、shallowReadonly" class="headerlink" title="shallowRef、shallowReactive、readonly、shallowReadonly"></a>shallowRef、shallowReactive、readonly、shallowReadonly</h4><p>shallowRef：如果参数是原子类型数据，作用和<code>ref</code>一样；如果是对象，则对象中的数据都不是响应式，但是可以替换对象<br>shallowReactive：只有对象的<strong>第一层</strong>属性是响应式，其他层次数据不是响应式<br>readonly：让一个响应式数据变成只读（<strong>深只读</strong>）<br>shallowReadonly：让一个响应式数据变成只读（<strong>浅只读</strong>）</p>
<h4 id="toRaw、markRaw"><a href="#toRaw、markRaw" class="headerlink" title="toRaw、markRaw"></a>toRaw、markRaw</h4><p>toRaw：将一个由<code>reactive</code>生成的响应式对象转为普通对象<br>markRaw：标记一个对象，使其永远不再成为响应式对象；在往响应式对象中添加对象时使用</p>
<h4 id="customRef"><a href="#customRef" class="headerlink" title="customRef"></a>customRef</h4><p>自定义ref，传入参数track、trigger，使得Vue追踪以及触发模板更新</p>
<h4 id="provide、inject，祖孙组件间数据传递"><a href="#provide、inject，祖孙组件间数据传递" class="headerlink" title="provide、inject，祖孙组件间数据传递"></a>provide、inject，祖孙组件间数据传递</h4><h4 id="响应式数据的判断"><a href="#响应式数据的判断" class="headerlink" title="响应式数据的判断"></a>响应式数据的判断</h4><p>isRef：检查一个值是否位一个ref对象<br>isReactive：检查一个对象是否是由reactive创建的响应式代理<br>isReadonly：检查一个对象是否是由readonly创建的只读代理<br>isProxy：检查一个对象是否是由reactive或者readonly方法创建的代理</p>
<h3 id="5、-新增三个组件"><a href="#5、-新增三个组件" class="headerlink" title="5、 新增三个组件"></a>5、 新增三个组件</h3><h4 id="5-1-Fragment"><a href="#5-1-Fragment" class="headerlink" title="5.1 Fragment"></a>5.1 Fragment</h4><ul>
<li>在Vue2中: 组件必须有一个根 结点 ， 很多时候会添加一些没有意义的节点用于包裹。Fragment组件就是用于解决这个问题的 </li>
<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>
<li>好处: 减少标签层级, 减小内存占用</li>
</ul>
<h4 id="5-2-Teleport"><a href="#5-2-Teleport" class="headerlink" title="5.2 Teleport"></a>5.2 Teleport</h4><p><code>&lt;Teleport&gt;</code> 是一个内置组件，它可以将一个组件内部的一部分模板“传送”到该组件的 DOM 结构外层的位置去。</p>
<p><code>Teleport</code> 是一种能够将我们的组件html结构移动到指定位置的技术</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>teleport</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>移动位置<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isShow<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mask<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>我是一个弹窗<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>isShow <span class="token punctuation">=</span> false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>关闭弹窗<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>teleport</span><span class="token punctuation">></span></span></code></pre>
<h4 id="5-3-Suspense-实验性功能"><a href="#5-3-Suspense-实验性功能" class="headerlink" title="5.3 Suspense (实验性功能)"></a>5.3 Suspense (实验性功能)</h4><p>等待异步组件时渲染一些额外内容，让应用有更好的用户体验</p>
<p>用法</p>
<ul>
<li>异步引入组件</li>
<li>使用Suspense包裹组件，并配置好default 与 fallback</li>
<li>default：就是组件要显示的内容</li>
<li>fallback：就是组件没加载完全的“备胎”（类似于img标签的alt属性）</li>
</ul>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>我是App组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Suspense</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>default</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">v-slot:</span>fallback</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>加载中.....<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Suspense</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
</code></pre>
<h2 id="三、Vue3-0-是如何变快的？"><a href="#三、Vue3-0-是如何变快的？" class="headerlink" title="三、Vue3.0 是如何变快的？"></a>三、Vue3.0 是如何变快的？</h2><ul>
<li>diff 算法优化<ul>
<li>Vue2 中的虚拟dom 是进行全量对比</li>
<li>Vue3 新增静态标记</li>
</ul>
</li>
<li>hoistStatic 静态提升<ul>
<li>Vue2 中无论元素是否参与更新，每次都会重新创建，然后在渲染</li>
<li>Vue3 中对于不参与更新的元素，会做静态提升，只被创建一次，在渲染时直接复用即可</li>
</ul>
</li>
<li>cacheHandlers 事件侦听器缓存<ul>
<li>默认情况下默认情况下onClick会被视为动态绑定，所以每次都会去追踪它的变化，但是因为是同一个函数，所以没有追踪变化，直接缓存起来复用即可</li>
</ul>
</li>
<li>ssr 渲染<ul>
<li>当有大量静态的内容的时候，这些内容会被当作纯字符串推进一个buffer里面，即使存在动态的绑定，会通过模版插值嵌入进去，这样会比通过虚拟dom来渲染的快上很多很多</li>
<li>当静态内容大到一定量级的时候，会用_createStaticVNode方法在客户端去生成一个static node。这些静态node，会被直接innerHtml，就不需要创建对象，然后根据对象渲染。</li>
</ul>
</li>
</ul>
<h2 id="四、问题汇总"><a href="#四、问题汇总" class="headerlink" title="四、问题汇总"></a>四、问题汇总</h2><h3 id="1-vue3没有this怎么办？"><a href="#1-vue3没有this怎么办？" class="headerlink" title="1.vue3没有this怎么办？"></a>1.vue3没有this怎么办？</h3><p>在vue3中，新的组合式API中没有this，那我们如果需要用到<code>this</code>怎么办? </p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法:"></a>解决方法:</h4><p><code>getCurrentInstance</code> 方法获取当前组件的实例，然后通过 <code>ctx</code> 或 <code>proxy</code> 属性获得当前上下文，这样我们就能在<code>setup</code>中使用<code>router</code>和<code>vuex</code>了</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> proxy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">$axios</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
        proxy<span class="token punctuation">.</span><span class="token function">$router</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>但不建议使用<code>getCurrentInstance</code>方法。如果要使用<code>router</code>和<code>vuex</code>，推荐这样用:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute<span class="token punctuation">,</span> useRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    setup <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 在 computed 函数中访问 state</span>
            count<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span>

            <span class="token comment" spellcheck="true">// 在 computed 函数中访问 getter</span>
            double<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>double<span class="token punctuation">)</span>

            <span class="token comment" spellcheck="true">// 使用 mutation</span>
            increment<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

            <span class="token comment" spellcheck="true">// 使用 action</span>
            asyncIncrement<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'asyncIncrement'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>大家不要依赖 <code>getCurrentInstance</code> 方法去获取组件实例来完成一些主要功能，否则在项目打包后，可能会报错的。</p>
<h3 id="2-Vue-数据更新了但页面没有更新的情况"><a href="#2-Vue-数据更新了但页面没有更新的情况" class="headerlink" title="2.Vue 数据更新了但页面没有更新的情况"></a>2.Vue 数据更新了但页面没有更新的情况</h3><blockquote>
<p>如果，你发现自己需要在vue中做一次强制更新，99.9%的情况，是你在某个地方做错了事</p>
</blockquote>
<h4 id="1-vue无法检测实例被创建时，不存在于data中的property"><a href="#1-vue无法检测实例被创建时，不存在于data中的property" class="headerlink" title="1.vue无法检测实例被创建时，不存在于data中的property"></a>1.vue无法检测实例被创建时，不存在于data中的property</h4><p>原因：参数没有在<code>data</code>里声明</p>
<p>由于Vue会在初始化实例时，对<code>property</code>执行<code>getter/setter</code>转化，所以，<code>property</code>必须在<code>data</code>对象上存在才能让Vue将它转化为响应式的。</p>
<p>场景：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 页面不会变化</span>
    template<span class="token punctuation">:</span> <span class="token string">'&lt;div>{{message}}&lt;/div>'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'Hello!'</span> <span class="token comment" spellcheck="true">// `vm.message` 不是响应式的</span></code></pre>
<p>解决办法：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 声明 a、b 为一个空值字符串</span>
        message<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token string">'&lt;div>{{ message }}&lt;/div>'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'Hello!'</span></code></pre>
<h4 id="2-vue无法检测对象property的添加或移除"><a href="#2-vue无法检测对象property的添加或移除" class="headerlink" title="2.vue无法检测对象property的添加或移除"></a>2.vue无法检测对象property的添加或移除</h4><p>原因：</p>
<p>由于JavaScript(ES5)的限制，Vue不能检测到对象属性的添加或删除。因为vue.js在初始化实例时将属性转为<code>getter/setter</code>，所以属性必须在<code>data</code>对象上才能让Vue转换它，才能让它使响应的。</p>
<p>场景：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token punctuation">:</span><span class="token punctuation">{</span>
        obj<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            id<span class="token punctuation">:</span> <span class="token number">001</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 页面不会变化</span>
    template<span class="token punctuation">:</span> <span class="token string">'&lt;div>{{ obj.message }}&lt;/div>'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

vm<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'hello'</span> <span class="token comment" spellcheck="true">// 不是响应式的</span>
<span class="token keyword">delete</span> vm<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>id       <span class="token comment" spellcheck="true">// 不是响应式的</span></code></pre>
<p>解决办法：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//动态添加 -- vue.set</span>
Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>propertyName<span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//动态添加 -- vm.$set</span>
vm<span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>propertyName<span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//动态添加多个</span>
<span class="token comment" spellcheck="true">// 代替Object.assign(this.obj,{a:1,b:2})</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">,</span><span class="token punctuation">{</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//动态移除--vm.$delect</span>
Vue<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//动态移除 --vm.$delete</span>
vm<span class="token punctuation">.</span>$<span class="token keyword">delete</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>propertyName<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="3-vue不能检测通过数组索引值，直接修改一个数组项"><a href="#3-vue不能检测通过数组索引值，直接修改一个数组项" class="headerlink" title="3.vue不能检测通过数组索引值，直接修改一个数组项"></a>3.vue不能检测通过数组索引值，直接修改一个数组项</h4><p>原因：Vue不能检测数组和对象的变化。</p>
<p>场景：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token comment" spellcheck="true">// 不是响应性的</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'m'</span> <span class="token comment" spellcheck="true">// 不是响应性的</span></code></pre>
<p>解决办法：</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">//Vue.set</span>
Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span>indexOfItem<span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//vm.$set</span>
vm<span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span>indexOfItem<span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//Array.prototype.splice</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>indexOfItem<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>newValue<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>更多有关数据更新了但是页面没有更新的情况，查看<a href="https://blog.csdn.net/qq_26780317/article/details/120130388" target="_blank" rel="noopener">Vue 数据更新了但页面没有更新的情况</a></p>
<p>本文参考：</p>
<ul>
<li><a href="https://v3-migration.vuejs.org/zh/breaking-changes/" target="_blank" rel="noopener"> Vue 3 迁移指南 </a></li>
</ul>
<p>延伸阅读：</p>
<ul>
<li><a href="https://cn.vuejs.org/guide/extras/reactivity-in-depth.html" target="_blank" rel="noopener">深入响应性原理</a>：理解 Vue 响应性系统的底层细节。</li>
<li><a href="https://cn.vuejs.org/guide/scaling-up/state-management.html" target="_blank" rel="noopener">状态管理</a>：多个组件间共享状态的管理模式。</li>
<li><a href="https://cn.vuejs.org/guide/scaling-up/testing.html#testing-composables" target="_blank" rel="noopener">测试组合式函数</a>：组合式函数的单元测试技巧。</li>
<li><a href="https://vueuse.org/" target="_blank" rel="noopener">VueUse</a>：一个日益增长的 Vue 组合式函数集合。源代码本身就是一份不错的学习资料。</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">弈心</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://blog.tianyichuxin.com/2023/04/12043.html">https://blog.tianyichuxin.com/2023/04/12043.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">弈心</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/vue/">
                                    <span class="chip bg-color">vue</span>
                                </a>
                            
                                <a href="/tags/vue3/">
                                    <span class="chip bg-color">vue3</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'Pz2erXCl206N7RaqUeABaxY5-gzGzoHsz',
        appKey: 'jK6ogq40WtwTaW0p3l097QhN',
        notify: 'false' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '说点什么再走吧'
    });
</script>

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/04/38381.html">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/24.jpg" class="responsive-img" alt="Vue项目中录音">
                        
                        <span class="card-title">Vue项目中录音</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Vue项目中录音
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-04-22
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/vue/" class="post-category">
                                    vue
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/vue/">
                        <span class="chip bg-color">vue</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/02/32915.html">
                    <div class="card-image">
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="公安备案接入服务商如何填写？(网站接入信息)">
                        
                        <span class="card-title">公安备案接入服务商如何填写？(网站接入信息)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            公安备案接入服务商如何填写？(网站接入信息)
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-02-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%A4%87%E6%A1%88/" class="post-category">
                                    备案
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%A4%87%E6%A1%88/">
                        <span class="chip bg-color">备案</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 天弈初心<br />'
            + '文章作者: 弈心<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
<div class="_fogwnirvpfw" id="_fogwnirvpfw"></div>
<script type="text/javascript">
    (window.slotbydup = window.slotbydup || []).push({
        id: "u6938726",
        container: "_fogwnirvpfw",
        async: true
    });
</script>
<div class="_s210mav3xgf" id="_s210mav3xgf"></div>
<script type="text/javascript">
    (window.slotbydup = window.slotbydup || []).push({
        id: "u6938735",
        container: "_s210mav3xgf",
        async: true
    });
</script>

<!-- 多条广告如下脚本只需引入一次 -->
<script type="text/javascript" src="//cpro.baidustatic.com/cpro/ui/cm.js" async="async" defer="defer" >
</script>
    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<!-- <script src="https://fastly.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script> -->
<script src="https://static.tianyichuxin.com/assets/npm/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2018</span>
            <a href="/about" target="_blank">弈心</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">309.3k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2018";
                    var startMonth = "1";
                    var startDate = "1";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42018502006491" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;margin-right: 10px;">鄂公网安备 42018502006491号</a>
                <a href="https://beian.miit.gov.cn" target="_blank">鄂ICP备19020385号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/tianyichuxin" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:535399046@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=535399046" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 535399046" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="" class="tooltipped" target="_blank" data-tooltip="关注我的微信公众号: tianyichuxin_2023" data-position="top" data-delay="50">
        <i class="fab fa-weixin"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>

    <link rel="stylesheet" type="text/css" href="http://static.tianyichuxin.com/assets/live2D/css/waifu.css" />
    <link rel="stylesheet" type="text/css" href="http://static.tianyichuxin.com/assets/live2D/css/flat-ui.min.css" />
    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
	<div class="waifu">
		<!-- 提示框 -->
		<!-- <div class="waifu-tips"></div> -->

		<!-- 看板娘画布 -->
		<!-- <canvas id="live2d" class="live2d" width="280" height="250"></canvas> -->

		<!-- 工具栏 -->
		<!-- <div class="waifu-tool">
			<span class="fui-home"></span>
			<span class="fui-chat"></span>
			<span class="fui-eye"></span>
			<span class="fui-user"></span>
			<span class="fui-photo"></span>
			<span class="fui-info-circle"></span>
			<span class="fui-cross"></span>
		</div> -->
	</div>
</body>
</html>
<!-- 右下角人物和鼠标点击 -->
<!-- <script src="http://static.tianyichuxin.com/assets/live2D/js/waifu--tips.js"></script> -->
<!-- <script src="http://static.tianyichuxin.com/assets/live2D/js/live2d.js"></script> -->
<!-- 小姐姐 -->
<!-- <script src="http://static.tianyichuxin.com/assets/live2D/js/L2Dwidget.min.js"></script> -->
<!-- <script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> -->
<!-- 鼠标点击 -->
<script src="http://static.tianyichuxin.com/assets/live2D/js/mouse.js"></script>
<script type="text/javascript">
    // /* 可直接修改部分参数 */
    // live2d_settings['modelId'] = 5; // 默认模型 ID
    // live2d_settings['modelTexturesId'] = 1; // 默认材质 ID
    // /* 在 initModel 前添加 */
    // initModel("http://static.tianyichuxin.com/assets/live2D/js/waifu-tips.json")
</script>